{% extends "base.html" %}
{% block content %}
  <div class="max-w-2xl mx-auto">
    <div class="glass-card rounded-2xl border border-slate-800/70 shadow-xl p-8">
      <div class="mb-6">
        <p class="text-sm uppercase tracking-[0.2em] text-slate-400">Step 1</p>
        <h1 class="text-2xl md:text-3xl font-semibold text-white mt-2">Paste a recipe URL</h1>
        <p class="text-slate-400 mt-1">We will try to pull the title, ingredients, instructions, and image. You can edit everything before saving.</p>
      </div>
      <form method="post" action="/import" class="space-y-4" id="importForm">
        <label class="block text-sm font-medium text-slate-200">Recipe link</label>
        <input name="url" type="url" required placeholder="https://example.com/your-favorite-recipe" class="w-full rounded-xl bg-slate-800/70 border border-slate-700 px-4 py-3 text-white placeholder:text-slate-500 focus:border-teal-300 focus:outline-none" />
        
        <div class="bg-slate-800/50 border border-slate-700 rounded-xl p-4">
          <p class="text-xs text-slate-400">Import method: Automatic cascade</p>
          <p class="text-xs text-slate-300 mt-1">1. Standard scraper (fastest)</p>
          <p class="text-xs text-slate-300">2. Gemini AI (if standard fails)</p>
          <p class="text-xs text-slate-300">3. Ollama local AI (if both fail)</p>
        </div>

        <button type="submit" id="submitBtn" class="w-full rounded-xl bg-teal-500 text-slate-950 font-semibold py-3 hover:bg-teal-400 transition disabled:opacity-75 disabled:cursor-not-allowed">
          <span id="submitText">Fetch recipe</span>
          <span id="loadingText" class="hidden inline-flex items-center gap-2">
            <svg class="animate-spin h-5 w-5 text-slate-950" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            Processing...
          </span>
        </button>
        
        <div id="progressContainer" class="hidden">
          <p class="text-xs text-slate-400 text-center mb-2">Fetching recipe... This may take 10-60 seconds</p>
          <div class="w-full bg-slate-700 rounded-full h-3 overflow-hidden">
            <div class="bg-gradient-to-r from-teal-400 to-teal-500 h-3 rounded-full transition-all duration-300" id="progressFill" style="width: 10%"></div>
          </div>
        </div>
      </form>
      
      <script>
        document.getElementById('importForm').addEventListener('submit', function(e) {
          const submitBtn = document.getElementById('submitBtn');
          const submitText = document.getElementById('submitText');
          const loadingText = document.getElementById('loadingText');
          const progressContainer = document.getElementById('progressContainer');
          const progressFill = document.getElementById('progressFill');
          
          // Show loading state immediately
          submitBtn.disabled = true;
          submitText.classList.add('hidden');
          loadingText.classList.remove('hidden');
          progressContainer.classList.remove('hidden');
          
          // Animate progress bar
          let progress = 10;
          progressFill.style.width = '10%';
          
          const interval = setInterval(() => {
            progress += Math.random() * 20;
            if (progress > 85) progress = 85; // Stop at 85% until complete
            progressFill.style.width = progress + '%';
          }, 300);
          
          // Store interval to clean up if needed
          window.recipeImportInterval = interval;
        });
        
        // Clean up interval on page unload
        window.addEventListener('beforeunload', () => {
          if (window.recipeImportInterval) {
            clearInterval(window.recipeImportInterval);
          }
        });
        });
      </script>
      <div class="mt-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 text-sm text-slate-300">
        <a href="/manual" class="hover:text-white">Add manually instead</a>
        <a href="/recipes" class="text-teal-300 hover:text-teal-200">View all recipes â†’</a>
      </div>
    </div>
  </div>
{% endblock %}
